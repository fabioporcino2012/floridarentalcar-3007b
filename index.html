<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FRC ALL ‚Äî Sistema de Gest√£o CEO</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
:root{--bg:#0B0D12;--bg2:#13161E;--bg3:#1B1F2A;--bg4:#252A38;--bdr:#2B3142;--tx:#E8ECF4;--tx2:#8B95A8;--tx3:#5A6478;--acc:#E87722;--acc2:#FF9A4D;--red:#EF4444;--grn:#22C55E;--ylw:#EAB308;--blu:#3B82F6;--pur:#A855F7;--wht:#fff}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'DM Sans',sans-serif;background:var(--bg);color:var(--tx);min-height:100vh}
.app{display:flex;min-height:100vh}

/* SIDEBAR */
.sb{width:260px;min-width:260px;background:var(--bg2);border-right:1px solid var(--bdr);height:100vh;position:sticky;top:0;overflow-y:auto;scrollbar-width:thin;scrollbar-color:var(--bg4) transparent;display:flex;flex-direction:column}
.sb-hd{padding:18px;border-bottom:1px solid var(--bdr);background:linear-gradient(135deg,#0a0400,#0B0D12)}
.sb-logo{font-family:'Space Mono',monospace;font-size:17px;font-weight:700;color:var(--acc)}
.sb-sub{font-size:10px;color:var(--tx3);margin-top:3px;text-transform:uppercase;letter-spacing:1.5px}
.sb-grp{padding:14px 14px 4px;font-size:9px;text-transform:uppercase;letter-spacing:1.5px;font-weight:700}
.sb-item{display:flex;align-items:center;gap:8px;padding:7px 14px 7px 22px;cursor:pointer;font-size:12.5px;color:var(--tx2);border-left:3px solid transparent;transition:.15s}
.sb-item:hover{background:var(--bg3);color:var(--tx)}
.sb-item.act{background:var(--bg3);color:var(--acc);border-left-color:var(--acc);font-weight:600}
.sb-item .ic{font-size:14px;width:20px;text-align:center}
.sb-top{display:flex;align-items:center;gap:8px;padding:10px 14px;cursor:pointer;font-size:13px;font-weight:600;color:var(--tx);border-left:3px solid transparent;transition:.15s}
.sb-top:hover{background:var(--bg3)}
.sb-top.act{background:var(--bg3);color:var(--acc);border-left-color:var(--acc)}
.sb-link{margin-top:auto;padding:14px;border-top:1px solid var(--bdr)}
.sb-link a{display:block;text-align:center;padding:10px;background:linear-gradient(135deg,var(--acc),#D4380D);border-radius:8px;color:#fff;font-size:12px;font-weight:600;text-decoration:none;transition:.15s}
.sb-link a:hover{opacity:.9;transform:scale(1.02)}

/* MAIN */
.mn{flex:1;padding:24px 28px;overflow-y:auto;min-height:100vh}
.pg-hd{display:flex;align-items:center;justify-content:space-between;margin-bottom:24px;padding-bottom:18px;border-bottom:1px solid var(--bdr)}
.pg-tt{font-family:'Space Mono',monospace;font-size:20px;font-weight:700;display:flex;align-items:center;gap:10px}
.pg-badge{font-size:10px;padding:3px 10px;border-radius:20px;font-family:'DM Sans';font-weight:600}
.pg-date{font-size:11px;color:var(--tx3)}

/* STATS */
.st-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:14px;margin-bottom:22px}
.st-card{background:var(--bg2);border:1px solid var(--bdr);border-radius:10px;padding:14px;position:relative;overflow:hidden}
.st-card .bar{position:absolute;top:0;left:0;right:0;height:3px}
.st-lb{font-size:10px;color:var(--tx3);text-transform:uppercase;letter-spacing:1px;margin-bottom:6px}
.st-val{font-family:'Space Mono',monospace;font-size:24px;font-weight:700}
.st-sub{font-size:11px;color:var(--tx2);margin-top:3px}

/* SECTOR GRID */
.sec-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:12px}
.sec-card{background:var(--bg2);border:1px solid var(--bdr);border-radius:10px;padding:14px;cursor:pointer;transition:.2s;position:relative;overflow:hidden}
.sec-card:hover{border-color:var(--acc);transform:translateY(-2px);box-shadow:0 6px 20px rgba(0,0,0,.3)}
.sec-card .bar{position:absolute;bottom:0;left:0;right:0;height:3px}
.sec-top{display:flex;align-items:center;gap:8px;margin-bottom:8px}
.sec-ic{font-size:22px}
.sec-nm{font-size:13px;font-weight:700}
.sec-ld{font-size:10px;color:var(--tx3)}
.sec-stats{display:flex;gap:14px;margin-top:8px;font-size:11px;color:var(--tx2)}
.sec-stats span{font-weight:700;color:var(--tx)}
.sec-kpi{margin-top:8px}
.sec-kpi-bar{height:4px;background:var(--bg4);border-radius:2px;overflow:hidden}
.sec-kpi-fill{height:100%;border-radius:2px}
.sec-kpi-txt{font-family:'Space Mono',monospace;font-size:11px;font-weight:700;margin-top:3px}

/* TABS */
.tabs{display:flex;gap:2px;margin-bottom:18px;border-bottom:1px solid var(--bdr);flex-wrap:wrap}
.tab{padding:8px 16px;font-size:12px;font-weight:500;cursor:pointer;color:var(--tx3);border-bottom:2px solid transparent;transition:.15s;white-space:nowrap}
.tab:hover{color:var(--tx2)}
.tab.act{color:var(--acc);border-bottom-color:var(--acc);font-weight:700}

/* CARD */
.card{background:var(--bg2);border:1px solid var(--bdr);border-radius:10px;padding:18px;margin-bottom:18px}
.card-tt{font-size:13px;font-weight:700;text-transform:uppercase;letter-spacing:.8px;display:flex;align-items:center;gap:8px;margin-bottom:14px}
.card-hd{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}

/* TABLE */
.tw{overflow-x:auto}
table{width:100%;border-collapse:collapse;font-size:12px}
th{text-align:left;padding:8px 10px;font-size:10px;text-transform:uppercase;letter-spacing:1px;color:var(--tx3);font-weight:700;border-bottom:1px solid var(--bdr);white-space:nowrap}
td{padding:8px 10px;border-bottom:1px solid var(--bdr);vertical-align:top}
tr:hover td{background:var(--bg3)}

/* BADGES */
.bdg{display:inline-block;padding:2px 7px;border-radius:10px;font-size:10px;font-weight:600}
.bdg-p{background:rgba(234,179,8,.15);color:var(--ylw)}
.bdg-a{background:rgba(59,130,246,.15);color:var(--blu)}
.bdg-c{background:rgba(34,197,94,.15);color:var(--grn)}
.bdg-b{background:rgba(239,68,68,.15);color:var(--red)}

/* KPI */
.kpi-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:10px}
.kpi-card{background:var(--bg3);border:1px solid var(--bdr);border-radius:8px;padding:12px}
.kpi-bar{height:5px;background:var(--bg4);border-radius:3px;overflow:hidden;margin-top:5px}
.kpi-fill{height:100%;border-radius:3px}

/* METAS */
.mt-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:8px}
.mt-card{background:var(--bg3);border:1px solid var(--bdr);border-radius:7px;padding:10px;text-align:center}
.mt-month{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--tx3);margin-bottom:6px}
.mt-val{font-size:11px;color:var(--tx2);margin-bottom:2px}
.mt-pct{font-family:'Space Mono',monospace;font-size:14px;font-weight:700}

/* VISION */
.vis-grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
.vis-box{background:var(--bg3);border:1px solid var(--bdr);border-radius:8px;padding:14px}
.vis-lb{font-size:10px;text-transform:uppercase;letter-spacing:1px;color:var(--tx3);font-weight:700;margin-bottom:6px}
.vis-val{font-size:13px;color:var(--tx);line-height:1.6;white-space:pre-wrap}

/* TEXT BLOCK */
.txt-block{background:var(--bg3);border:1px solid var(--bdr);border-radius:8px;padding:16px;font-size:13px;line-height:1.7;white-space:pre-wrap;min-height:100px}

/* EMPTY */
.empty{text-align:center;padding:30px 20px;color:var(--tx3);font-size:12px}
.empty-ic{font-size:30px;margin-bottom:10px}

/* PROGRESS RING */
.ring-wrap{display:flex;align-items:center;justify-content:center;gap:20px;flex-wrap:wrap;margin-bottom:20px}
.ring{position:relative;width:120px;height:120px}
.ring svg{transform:rotate(-90deg)}
.ring-val{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-family:'Space Mono',monospace;font-size:22px;font-weight:700}
.ring-lb{text-align:center;font-size:10px;color:var(--tx3);margin-top:4px;text-transform:uppercase;letter-spacing:1px}

/* RESPONSIVE */
@media(max-width:768px){
  .sb{width:52px;min-width:52px}
  .sb-hd{padding:10px 6px;text-align:center}
  .sb-sub,.sb-grp,.sb-item .nm,.sb-top .nm,.sb-link{display:none}
  .sb-logo{font-size:12px}
  .sb-item{padding:8px;justify-content:center}
  .sb-top{justify-content:center}
  .mn{padding:14px}
  .vis-grid{grid-template-columns:1fr}
  .st-grid{grid-template-columns:repeat(2,1fr)}
}
</style>
</head>
<body>
<div class="app" id="app"></div>
<script>
const SECTORS=[
  {id:"mkt",name:"Marketing",icon:"üì£",group:"Vendas & Marketing",leader:"",color:"#E87722"},
  {id:"comercial",name:"Comercial",icon:"üí∞",group:"Vendas & Marketing",leader:"",color:"#D4380D"},
  {id:"kommo",name:"Kommo (CRM)",icon:"üìã",group:"Vendas & Marketing",leader:"",color:"#FA8C16"},
  {id:"operacional",name:"Operacional",icon:"‚öôÔ∏è",group:"Opera√ß√£o & Log√≠stica",leader:"",color:"#1890FF"},
  {id:"entdev",name:"Ent/Devolu√ß√£o",icon:"üöó",group:"Opera√ß√£o & Log√≠stica",leader:"",color:"#096DD9"},
  {id:"frota",name:"Frota",icon:"üÖøÔ∏è",group:"Opera√ß√£o & Log√≠stica",leader:"",color:"#0050B3"},
  {id:"oficina",name:"Oficina",icon:"üîß",group:"Opera√ß√£o & Log√≠stica",leader:"",color:"#003A8C"},
  {id:"cegonha",name:"Cegonha",icon:"üöö",group:"Opera√ß√£o & Log√≠stica",leader:"",color:"#002766"},
  {id:"coo",name:"COO",icon:"üéØ",group:"Opera√ß√£o & Log√≠stica",leader:"",color:"#13C2C2"},
  {id:"disponibilidade",name:"Disponibilidade",icon:"üìä",group:"Opera√ß√£o & Log√≠stica",leader:"Queren",color:"#006D75"},
  {id:"posvenda",name:"P√≥s-venda",icon:"üìû",group:"Cliente",leader:"",color:"#52C41A"},
  {id:"suporte",name:"Suporte",icon:"üÜò",group:"Cliente",leader:"",color:"#389E0D"},
  {id:"cs",name:"CS (Ritmo)",icon:"‚è±Ô∏è",group:"Cliente",leader:"",color:"#237804"},
  {id:"sucesso",name:"Sucesso Cliente",icon:"‚≠ê",group:"Cliente",leader:"",color:"#135200"},
  {id:"financeiro",name:"Financeiro",icon:"üè¶",group:"Backoffice",leader:"Daniela",color:"#722ED1"},
  {id:"pessoas",name:"Pessoas e Cultura",icon:"üë•",group:"Backoffice",leader:"Jo√£o Victor",color:"#531DAB"},
  {id:"qualidade",name:"Qualidade",icon:"‚úÖ",group:"Backoffice",leader:"Eduardo",color:"#391085"},
  {id:"update",name:"Update",icon:"üîÑ",group:"Backoffice",leader:"",color:"#EB2F96"},
  {id:"dashboard",name:"Dashboard (BI)",icon:"üìà",group:"Sistemas",leader:"",color:"#C41D7F"},
  {id:"dunas",name:"Dunas (Sistema)",icon:"üíª",group:"Sistemas",leader:"",color:"#9E1068"},
  {id:"apn",name:"APN (Parceiro)",icon:"ü§ù",group:"Sistemas",leader:"",color:"#780650"},
  {id:"ia",name:"IA (Automa√ß√£o)",icon:"ü§ñ",group:"Estrat√©gico",leader:"",color:"#FAAD14"},
  {id:"plus",name:"Plus (Inova√ß√£o)",icon:"üöÄ",group:"Estrat√©gico",leader:"",color:"#D48806"},
  {id:"clube",name:"Clube Banco",icon:"üí≥",group:"Estrat√©gico",leader:"",color:"#AD6800"},
];
const GROUPS=["Vendas & Marketing","Opera√ß√£o & Log√≠stica","Cliente","Backoffice","Sistemas","Estrat√©gico"];
const GCOL={"Vendas & Marketing":"#E87722","Opera√ß√£o & Log√≠stica":"#1890FF","Cliente":"#52C41A","Backoffice":"#722ED1","Sistemas":"#C41D7F","Estrat√©gico":"#FAAD14"};
const MOS=["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"];
const STS_MAP={"Pendente":"bdg-p","Em andamento":"bdg-a","Conclu√≠do":"bdg-c","Bloqueado":"bdg-b"};

const DB_KEY="frc-all-data";
let DATA={};
let PAGE="dashboard";
let TAB="vision";

function load(){try{const d=localStorage.getItem(DB_KEY);DATA=d?JSON.parse(d):{}}catch(e){DATA={}}}
function getS(id){return DATA[id]||{vision:{},pendencias:[],tarefas:[],entregas:[],kpis:[],metas:MOS.map(m=>({month:m,meta:"",realizado:""})),rotinas:"",notes:""}}

function getSectorKPI(id){
  const d=getS(id);const items=d.kpis||[];
  let s=0,c=0;items.forEach(k=>{if(k.meta&&k.realizado){s+=Math.min((parseFloat(k.realizado)/parseFloat(k.meta))*100,100);c++}});
  return c?Math.round(s/c):null;
}
function col(pct){return pct>=80?"var(--grn)":pct>=50?"var(--ylw)":"var(--red)"}
function ring(pct,size,color,label){
  const r=size/2-8,circ=2*Math.PI*r,off=circ-(pct/100)*circ;
  return `<div style="text-align:center"><div class="ring" style="width:${size}px;height:${size}px">
    <svg width="${size}" height="${size}"><circle cx="${size/2}" cy="${size/2}" r="${r}" fill="none" stroke="var(--bg4)" stroke-width="6"/>
    <circle cx="${size/2}" cy="${size/2}" r="${r}" fill="none" stroke="${color}" stroke-width="6" stroke-dasharray="${circ}" stroke-dashoffset="${off}" stroke-linecap="round"/></svg>
    <div class="ring-val" style="color:${color}">${pct}%</div></div>
    <div class="ring-lb">${label}</div></div>`;
}

function render(){
  load(); // Re-read data each render to pick up admin changes
  const app=document.getElementById("app");
  app.innerHTML=`
    <div class="sb">
      <div class="sb-hd">
        <div class="sb-logo">FRC ALL</div>
        <div class="sb-sub">üìä Painel CEO</div>
      </div>
      <div class="sb-top ${PAGE==="dashboard"?"act":""}" onclick="PAGE='dashboard';render()">
        <span class="ic">üèÜ</span><span class="nm">Dashboard CEO</span>
      </div>
      <div class="sb-top ${PAGE==="ceo"?"act":""}" onclick="PAGE='ceo';TAB='vision';render()">
        <span class="ic">üëî</span><span class="nm">CEO Geral</span>
      </div>
      ${GROUPS.map(g=>`
        <div class="sb-grp" style="color:${GCOL[g]}"><span style="display:inline-block;width:7px;height:7px;border-radius:2px;background:${GCOL[g]};margin-right:4px"></span>${g}</div>
        ${SECTORS.filter(s=>s.group===g).map(s=>`
          <div class="sb-item ${PAGE===s.id?"act":""}" onclick="PAGE='${s.id}';TAB='vision';render()">
            <span class="ic">${s.icon}</span><span class="nm">${s.name}</span>
          </div>`).join("")}
      `).join("")}
      <div class="sb-link"><a href="admin.html">‚ö° Abrir Admin (Editar)</a></div>
    </div>
    <div class="mn">
      ${PAGE==="dashboard"?renderDash():PAGE==="ceo"?renderCEO():renderSector(PAGE)}
    </div>`;
}

// ========== DASHBOARD ==========
function renderDash(){
  let totalP=0,totalK=0,totalT=0,totalE=0,sumPct=0,cntPct=0;
  SECTORS.forEach(s=>{const d=getS(s.id);
    totalP+=(d.pendencias||[]).filter(x=>x.status!=="Conclu√≠do").length;
    totalK+=(d.kpis||[]).length;
    totalT+=(d.tarefas||[]).filter(x=>x.status!=="Conclu√≠do").length;
    totalE+=(d.entregas||[]).filter(x=>x.status==="Conclu√≠do").length;
    (d.kpis||[]).forEach(k=>{if(k.meta&&k.realizado){sumPct+=Math.min((parseFloat(k.realizado)/parseFloat(k.meta))*100,100);cntPct++}})
  });
  const avg=cntPct?Math.round(sumPct/cntPct):0;
  const avgC=col(avg);
  const now=new Date();
  const dateStr=now.toLocaleDateString("pt-BR",{weekday:"long",year:"numeric",month:"long",day:"numeric"});

  return `
    <div class="pg-hd">
      <div><div class="pg-tt">üèÜ FRC ALL ‚Äî Dashboard CEO</div><div class="pg-date">${dateStr}</div></div>
      <span class="pg-badge" style="background:rgba(232,119,34,.15);color:#E87722">24 Setores ‚Ä¢ 50+ Pessoas ‚Ä¢ 500 Ve√≠culos</span>
    </div>
    <div class="ring-wrap">
      ${ring(avg,130,avgC,"Performance Geral")}
      ${ring(totalP>0?Math.max(0,100-totalP*5):100,110,totalP>0?"var(--red)":"var(--grn)","Sa√∫de Pend√™ncias")}
      ${ring(Math.min(totalE*10,100),110,totalE>5?"var(--grn)":"var(--ylw)","Entregas Conclu√≠das")}
    </div>
    <div class="st-grid">
      <div class="st-card"><div class="bar" style="background:var(--red)"></div><div class="st-lb">Pend√™ncias Abertas</div><div class="st-val" style="color:var(--red)">${totalP}</div><div class="st-sub">em todos os setores</div></div>
      <div class="st-card"><div class="bar" style="background:var(--ylw)"></div><div class="st-lb">Tarefas Futuras</div><div class="st-val" style="color:var(--ylw)">${totalT}</div><div class="st-sub">a concluir</div></div>
      <div class="st-card"><div class="bar" style="background:var(--blu)"></div><div class="st-lb">KPIs Ativos</div><div class="st-val" style="color:var(--blu)">${totalK}</div><div class="st-sub">m√©tricas monitoradas</div></div>
      <div class="st-card"><div class="bar" style="background:var(--grn)"></div><div class="st-lb">Entregas Feitas</div><div class="st-val" style="color:var(--grn)">${totalE}</div><div class="st-sub">conclu√≠das no per√≠odo</div></div>
    </div>
    ${GROUPS.map(g=>`
      <div style="margin-bottom:20px">
        <div style="font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;color:${GCOL[g]};margin-bottom:10px;display:flex;align-items:center;gap:6px">
          <span style="width:10px;height:10px;border-radius:2px;background:${GCOL[g]};display:inline-block"></span>${g}
        </div>
        <div class="sec-grid">${SECTORS.filter(s=>s.group===g).map(s=>{
          const d=getS(s.id);const p=(d.pendencias||[]).filter(x=>x.status!=="Conclu√≠do").length;
          const kpi=getSectorKPI(s.id);const kpiC=kpi!==null?col(kpi):"var(--tx3)";
          return `<div class="sec-card" onclick="PAGE='${s.id}';TAB='vision';render()">
            <div class="sec-top"><span class="sec-ic">${s.icon}</span><div><div class="sec-nm">${s.name}</div><div class="sec-ld">${s.leader||"‚Äî"}</div></div></div>
            <div class="sec-stats"><div>Pend: <span style="color:${p>0?"var(--red)":"var(--grn)"}">${p}</span></div><div>KPIs: <span>${(d.kpis||[]).length}</span></div></div>
            ${kpi!==null?`<div class="sec-kpi"><div class="sec-kpi-bar"><div class="sec-kpi-fill" style="width:${kpi}%;background:${kpiC}"></div></div><div class="sec-kpi-txt" style="color:${kpiC}">${kpi}%</div></div>`:""}
            <div class="bar" style="background:${s.color}"></div>
          </div>`;
        }).join("")}</div>
      </div>
    `).join("")}
  `;
}

// ========== CEO ==========
function renderCEO(){
  const c=DATA._ceo||{};
  const tabs=[{id:"vision",l:"Vis√£o",i:"üéØ"},{id:"prioridades",l:"Prioridades",i:"üî•"},{id:"rotinas",l:"Rotinas",i:"üìÖ"},{id:"organograma",l:"Organograma",i:"üè¢"},{id:"fluxos",l:"Fluxos",i:"üîÄ"},{id:"notes",l:"Notas",i:"üìù"}];
  const content=c[TAB]||"";
  return `
    <div class="pg-hd"><div class="pg-tt">üëî CEO ‚Äî Vis√£o Geral</div><span class="pg-badge" style="background:rgba(232,119,34,.15);color:#E87722">Fabinho ‚Äî Florida Rental Car</span></div>
    <div class="tabs">${tabs.map(t=>`<div class="tab ${TAB===t.id?"act":""}" onclick="TAB='${t.id}';render()">${t.i} ${t.l}</div>`).join("")}</div>
    <div class="card">
      <div class="card-tt">${tabs.find(t=>t.id===TAB).i} ${tabs.find(t=>t.id===TAB).l}</div>
      ${content?`<div class="txt-block">${content}</div>`:`<div class="empty"><div class="empty-ic">üìù</div>Nenhum conte√∫do cadastrado. Use o <a href="admin.html" style="color:var(--acc)">Admin</a> para editar.</div>`}
    </div>
  `;
}

// ========== SECTOR DETAIL ==========
function renderSector(id){
  const cfg=SECTORS.find(s=>s.id===id);if(!cfg)return"";
  const d=getS(id);
  const tabs=[
    {id:"vision",l:"Vis√£o",i:"üéØ"},
    {id:"pendencias",l:"Pend√™ncias",i:"üî¥"},
    {id:"tarefas",l:"Tarefas",i:"üü†"},
    {id:"entregas",l:"Entregas",i:"üì¶"},
    {id:"kpis",l:"KPIs",i:"üìä"},
    {id:"metas",l:"Metas",i:"üéØ"},
    {id:"rotinas",l:"Rotinas",i:"üìÖ"},
    {id:"notes",l:"Notas CEO",i:"üìù"}
  ];
  return `
    <div class="pg-hd"><div class="pg-tt"><span>${cfg.icon}</span> ${cfg.name}</div><span class="pg-badge" style="background:${cfg.color}22;color:${cfg.color}">${cfg.group}</span></div>
    <div class="tabs">${tabs.map(t=>`<div class="tab ${TAB===t.id?"act":""}" onclick="TAB='${t.id}';render()">${t.i} ${t.l}</div>`).join("")}</div>
    ${TAB==="vision"?rVision(d,cfg):""}
    ${TAB==="pendencias"?rTable(d.pendencias,"Pend√™ncias","üî¥"):""}
    ${TAB==="tarefas"?rTable(d.tarefas,"Tarefas Futuras","üü†"):""}
    ${TAB==="entregas"?rTable(d.entregas,"Entregas","üì¶"):""}
    ${TAB==="kpis"?rKPIs(d):""}
    ${TAB==="metas"?rMetas(d):""}
    ${TAB==="rotinas"?rText(d.rotinas,"Rotinas","üìÖ"):""}
    ${TAB==="notes"?rText(d.notes,"Notas do CEO","üìù"):""}
  `;
}

function rVision(d,cfg){
  const v=d.vision||{};
  const hasData=v.mission||v.functions||v.gargalo||v.meta2026;
  if(!hasData)return `<div class="card"><div class="empty"><div class="empty-ic">üéØ</div>Nenhuma vis√£o cadastrada. Use o <a href="admin.html" style="color:var(--acc)">Admin</a> para editar.</div></div>`;
  return `<div class="card"><div class="card-tt">üéØ Vis√£o do Setor</div>
    <div class="vis-grid">
      ${v.mission?`<div class="vis-box"><div class="vis-lb">Miss√£o</div><div class="vis-val">${v.mission}</div></div>`:""}
      ${v.functions?`<div class="vis-box"><div class="vis-lb">Fun√ß√µes Principais</div><div class="vis-val">${v.functions}</div></div>`:""}
      ${v.gargalo?`<div class="vis-box"><div class="vis-lb">Maior Gargalo</div><div class="vis-val">${v.gargalo}</div></div>`:""}
      ${v.meta2026?`<div class="vis-box"><div class="vis-lb">Meta 2026</div><div class="vis-val">${v.meta2026}</div></div>`:""}
    </div>
    ${cfg.leader?`<div style="margin-top:12px;font-size:11px;color:var(--tx2)"><strong>L√≠der:</strong> ${cfg.leader}</div>`:""}
  </div>`;
}

function rTable(items,title,icon){
  if(!items||!items.length)return `<div class="card"><div class="empty"><div class="empty-ic">${icon}</div>Nenhum item cadastrado</div></div>`;
  const open=items.filter(x=>x.status!=="Conclu√≠do").length;
  return `<div class="card">
    <div class="card-hd"><div class="card-tt">${icon} ${title}</div><span style="font-size:11px;color:var(--tx3)">${open} abertas de ${items.length} total</span></div>
    <div class="tw"><table><thead><tr><th>Descri√ß√£o</th><th>Respons√°vel</th><th>Prioridade</th><th>Prazo</th><th>Status</th><th>%</th></tr></thead><tbody>
      ${items.map(it=>`<tr>
        <td style="max-width:280px">${it.desc}</td>
        <td>${it.responsavel||"‚Äî"}</td>
        <td style="font-size:11px">${it.prioridade||""}</td>
        <td style="font-size:11px;white-space:nowrap">${it.prazo||"‚Äî"}</td>
        <td><span class="bdg ${STS_MAP[it.status]||"bdg-p"}">${it.status}</span></td>
        <td><div style="display:flex;align-items:center;gap:6px"><div style="width:40px;height:4px;background:var(--bg4);border-radius:2px;overflow:hidden"><div style="height:100%;width:${it.pct||0}%;background:${(it.pct||0)>=80?"var(--grn)":(it.pct||0)>=50?"var(--ylw)":"var(--red)"};border-radius:2px"></div></div><span style="font-size:10px;font-family:'Space Mono',monospace">${it.pct||0}%</span></div></td>
      </tr>`).join("")}
    </tbody></table></div>
  </div>`;
}

function rKPIs(d){
  const items=d.kpis||[];
  if(!items.length)return `<div class="card"><div class="empty"><div class="empty-ic">üìä</div>Nenhum KPI cadastrado</div></div>`;
  let s=0,c=0;items.forEach(k=>{if(k.meta&&k.realizado){s+=Math.min((parseFloat(k.realizado)/parseFloat(k.meta))*100,100);c++}});
  const avg=c?Math.round(s/c):0;const avgC=col(avg);
  return `<div class="card">
    <div class="card-hd"><div class="card-tt">üìä KPIs do Setor</div><span style="font-family:'Space Mono',monospace;font-size:16px;font-weight:700;color:${avgC}">${avg}% geral</span></div>
    <div class="kpi-grid">${items.map(k=>{
      const pct=k.meta&&k.realizado?Math.min(Math.round((parseFloat(k.realizado)/parseFloat(k.meta))*100),100):0;
      const c2=col(pct);
      return `<div class="kpi-card">
        <div style="font-size:12px;font-weight:600;margin-bottom:6px">${k.name}</div>
        <div style="display:flex;justify-content:space-between;font-size:11px;color:var(--tx2);margin-bottom:4px">
          <span>Meta: ${k.meta||"‚Äî"}</span><span>Real: ${k.realizado||"‚Äî"}</span>
        </div>
        <div class="kpi-bar"><div class="kpi-fill" style="width:${pct}%;background:${c2}"></div></div>
        <div style="text-align:center;margin-top:4px;font-family:'Space Mono',monospace;font-size:14px;font-weight:700;color:${c2}">${pct}%</div>
      </div>`;
    }).join("")}</div>
  </div>`;
}

function rMetas(d){
  const metas=d.metas||MOS.map(m=>({month:m,meta:"",realizado:""}));
  return `<div class="card"><div class="card-tt">üéØ Metas vs Realizado ‚Äî 2026</div>
    <div class="mt-grid">${metas.map(m=>{
      const pct=m.meta&&m.realizado?Math.min(Math.round((parseFloat(m.realizado)/parseFloat(m.meta))*100),999):null;
      const c2=pct===null?"var(--tx3)":col(pct);
      return `<div class="mt-card">
        <div class="mt-month">${m.month}</div>
        ${m.meta?`<div class="mt-val">Meta: ${m.meta}</div>`:""}
        ${m.realizado?`<div class="mt-val">Real: ${m.realizado}</div>`:""}
        <div class="mt-pct" style="color:${c2}">${pct!==null?pct+"%":"‚Äî"}</div>
      </div>`;
    }).join("")}</div>
  </div>`;
}

function rText(content,title,icon){
  if(!content)return `<div class="card"><div class="empty"><div class="empty-ic">${icon}</div>Nenhum conte√∫do cadastrado</div></div>`;
  return `<div class="card"><div class="card-tt">${icon} ${title}</div><div class="txt-block">${content}</div></div>`;
}

// AUTO-REFRESH: reload data every 3 seconds to catch admin changes
setInterval(()=>{const old=JSON.stringify(DATA);load();if(JSON.stringify(DATA)!==old)render()},3000);

load();
render();
</script>
</body>
</html>
