<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FRC ALL â€” Admin</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg:#0B0D12;--bg2:#13161E;--bg3:#1B1F2A;--bg4:#252A38;
  --bdr:#2B3142;--tx:#E8ECF4;--tx2:#8B95A8;--tx3:#5A6478;
  --acc:#E87722;--acc2:#FF9A4D;--red:#EF4444;--grn:#22C55E;
  --ylw:#EAB308;--blu:#3B82F6;--pur:#A855F7;
}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'DM Sans',sans-serif;background:var(--bg);color:var(--tx);min-height:100vh}
.app{display:flex;min-height:100vh}

/* SIDEBAR */
.sb{width:260px;min-width:260px;background:var(--bg2);border-right:1px solid var(--bdr);height:100vh;position:sticky;top:0;overflow-y:auto;scrollbar-width:thin;scrollbar-color:var(--bg4) transparent;display:flex;flex-direction:column}
.sb-hd{padding:18px;border-bottom:1px solid var(--bdr);background:linear-gradient(135deg,#1a0800,#0B0D12)}
.sb-logo{font-family:'Space Mono',monospace;font-size:17px;font-weight:700;color:var(--acc)}
.sb-sub{font-size:10px;color:var(--tx3);margin-top:3px;text-transform:uppercase;letter-spacing:1.5px}
.sb-grp{padding:14px 14px 4px;font-size:9px;text-transform:uppercase;letter-spacing:1.5px;font-weight:700}
.sb-item{display:flex;align-items:center;gap:8px;padding:7px 14px 7px 22px;cursor:pointer;font-size:12.5px;color:var(--tx2);border-left:3px solid transparent;transition:.15s}
.sb-item:hover{background:var(--bg3);color:var(--tx)}
.sb-item.act{background:var(--bg3);color:var(--acc);border-left-color:var(--acc);font-weight:600}
.sb-item .ic{font-size:14px;width:20px;text-align:center}
.sb-top{display:flex;align-items:center;gap:8px;padding:10px 14px;cursor:pointer;font-size:13px;font-weight:600;color:var(--tx);border-left:3px solid transparent;transition:.15s}
.sb-top:hover{background:var(--bg3)}
.sb-top.act{background:var(--bg3);color:var(--acc);border-left-color:var(--acc)}
.sb-link{margin-top:auto;padding:14px;border-top:1px solid var(--bdr)}
.sb-link a{display:block;text-align:center;padding:10px;background:var(--bg3);border:1px solid var(--bdr);border-radius:8px;color:var(--acc);font-size:12px;font-weight:600;text-decoration:none;transition:.15s}
.sb-link a:hover{background:var(--acc);color:#fff}

/* MAIN */
.mn{flex:1;padding:24px 28px;overflow-y:auto;min-height:100vh}
.pg-hd{display:flex;align-items:center;justify-content:space-between;margin-bottom:24px;padding-bottom:18px;border-bottom:1px solid var(--bdr)}
.pg-tt{font-family:'Space Mono',monospace;font-size:20px;font-weight:700;display:flex;align-items:center;gap:10px}
.pg-badge{font-size:10px;padding:3px 10px;border-radius:20px;font-family:'DM Sans';font-weight:600}

/* CARDS */
.card{background:var(--bg2);border:1px solid var(--bdr);border-radius:10px;padding:18px;margin-bottom:18px}
.card-hd{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}
.card-tt{font-size:13px;font-weight:700;text-transform:uppercase;letter-spacing:.8px;display:flex;align-items:center;gap:8px}

/* STATS */
.st-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:14px;margin-bottom:22px}
.st-card{background:var(--bg2);border:1px solid var(--bdr);border-radius:10px;padding:14px;position:relative;overflow:hidden}
.st-card .bar{position:absolute;top:0;left:0;right:0;height:3px}
.st-lb{font-size:10px;color:var(--tx3);text-transform:uppercase;letter-spacing:1px;margin-bottom:6px}
.st-val{font-family:'Space Mono',monospace;font-size:24px;font-weight:700}
.st-sub{font-size:11px;color:var(--tx2);margin-top:3px}

/* SECTOR GRID */
.sec-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:12px}
.sec-card{background:var(--bg2);border:1px solid var(--bdr);border-radius:10px;padding:14px;cursor:pointer;transition:.2s;position:relative;overflow:hidden}
.sec-card:hover{border-color:var(--acc);transform:translateY(-2px);box-shadow:0 6px 20px rgba(0,0,0,.3)}
.sec-card .bar{position:absolute;bottom:0;left:0;right:0;height:3px}
.sec-top{display:flex;align-items:center;gap:8px;margin-bottom:8px}
.sec-ic{font-size:22px}
.sec-nm{font-size:13px;font-weight:700}
.sec-ld{font-size:10px;color:var(--tx3)}
.sec-stats{display:flex;gap:14px;margin-top:8px;font-size:11px;color:var(--tx2)}
.sec-stats span{font-weight:700;color:var(--tx)}

/* TABS */
.tabs{display:flex;gap:2px;margin-bottom:18px;border-bottom:1px solid var(--bdr);flex-wrap:wrap}
.tab{padding:8px 16px;font-size:12px;font-weight:500;cursor:pointer;color:var(--tx3);border-bottom:2px solid transparent;transition:.15s;white-space:nowrap}
.tab:hover{color:var(--tx2)}
.tab.act{color:var(--acc);border-bottom-color:var(--acc);font-weight:700}

/* TABLE */
.tw{overflow-x:auto}
table{width:100%;border-collapse:collapse;font-size:12px}
th{text-align:left;padding:8px 10px;font-size:10px;text-transform:uppercase;letter-spacing:1px;color:var(--tx3);font-weight:700;border-bottom:1px solid var(--bdr);white-space:nowrap}
td{padding:8px 10px;border-bottom:1px solid var(--bdr);vertical-align:top}
tr:hover td{background:var(--bg3)}

/* FORMS */
.fr{display:flex;gap:10px;margin-bottom:12px;flex-wrap:wrap}
input,textarea,select{background:var(--bg3);border:1px solid var(--bdr);color:var(--tx);padding:7px 10px;border-radius:7px;font-family:'DM Sans';font-size:12px;outline:0;transition:border .15s}
input:focus,textarea:focus,select:focus{border-color:var(--acc)}
textarea{resize:vertical;min-height:50px;width:100%}
select{cursor:pointer}
.if{flex:1;min-width:160px}
.is{width:110px}

/* BUTTONS */
.btn{display:inline-flex;align-items:center;gap:5px;padding:7px 14px;border-radius:7px;font-size:12px;font-weight:600;cursor:pointer;border:none;transition:.15s;font-family:'DM Sans'}
.btn-p{background:var(--acc);color:#fff}
.btn-p:hover{background:var(--acc2)}
.btn-d{background:var(--red);color:#fff}
.btn-d:hover{opacity:.85}
.btn-g{background:transparent;color:var(--tx2);border:1px solid var(--bdr)}
.btn-g:hover{border-color:var(--tx2);color:var(--tx)}
.btn-s{padding:4px 8px;font-size:11px}

/* BADGES */
.bdg{display:inline-block;padding:2px 7px;border-radius:10px;font-size:10px;font-weight:600}
.bdg-p{background:rgba(234,179,8,.15);color:var(--ylw)}
.bdg-a{background:rgba(59,130,246,.15);color:var(--blu)}
.bdg-c{background:rgba(34,197,94,.15);color:var(--grn)}
.bdg-b{background:rgba(239,68,68,.15);color:var(--red)}

/* KPI */
.kpi-bar{height:5px;background:var(--bg4);border-radius:3px;overflow:hidden;margin-top:5px}
.kpi-fill{height:100%;border-radius:3px;transition:width .3s}
.kpi-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:10px}

/* METAS */
.mt-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(130px,1fr));gap:8px}
.mt-card{background:var(--bg3);border:1px solid var(--bdr);border-radius:7px;padding:10px}
.mt-month{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--tx3);margin-bottom:6px}
.mt-card input{width:100%;padding:5px 7px;font-size:11px;margin-bottom:3px}
.mt-pct{font-family:'Space Mono',monospace;font-size:13px;font-weight:700;text-align:center;margin-top:3px}

/* VISION */
.vis-grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
.vis-grid>div{display:flex;flex-direction:column;gap:5px}
.vis-lb{font-size:10px;text-transform:uppercase;letter-spacing:1px;color:var(--tx3);font-weight:700}

/* EMPTY */
.empty{text-align:center;padding:30px 20px;color:var(--tx3);font-size:12px}
.empty-ic{font-size:30px;margin-bottom:10px}

/* TOAST */
.toast{position:fixed;bottom:16px;right:16px;background:var(--grn);color:#000;padding:8px 18px;border-radius:7px;font-weight:600;font-size:12px;z-index:1000;animation:su .3s ease}
@keyframes su{from{transform:translateY(16px);opacity:0}to{transform:translateY(0);opacity:1}}

/* RESPONSIVE */
@media(max-width:768px){
  .sb{width:52px;min-width:52px}
  .sb-hd{padding:10px 6px;text-align:center}
  .sb-sub,.sb-grp,.sb-item .nm,.sb-top .nm,.sb-link{display:none}
  .sb-logo{font-size:12px}
  .sb-item{padding:8px;justify-content:center}
  .sb-top{justify-content:center}
  .mn{padding:14px}
  .vis-grid{grid-template-columns:1fr}
  .st-grid{grid-template-columns:repeat(2,1fr)}
}
</style>
</head>
<body>
<div class="app" id="app"></div>

<script>
// ========== CONFIG ==========
const SECTORS = [
  {id:"mkt",name:"Marketing",icon:"ğŸ“£",group:"Vendas & Marketing",leader:"",color:"#E87722"},
  {id:"comercial",name:"Comercial",icon:"ğŸ’°",group:"Vendas & Marketing",leader:"",color:"#D4380D"},
  {id:"kommo",name:"Kommo (CRM)",icon:"ğŸ“‹",group:"Vendas & Marketing",leader:"",color:"#FA8C16"},
  {id:"operacional",name:"Operacional",icon:"âš™ï¸",group:"OperaÃ§Ã£o & LogÃ­stica",leader:"",color:"#1890FF"},
  {id:"entdev",name:"Ent/DevoluÃ§Ã£o",icon:"ğŸš—",group:"OperaÃ§Ã£o & LogÃ­stica",leader:"",color:"#096DD9"},
  {id:"frota",name:"Frota",icon:"ğŸ…¿ï¸",group:"OperaÃ§Ã£o & LogÃ­stica",leader:"",color:"#0050B3"},
  {id:"oficina",name:"Oficina",icon:"ğŸ”§",group:"OperaÃ§Ã£o & LogÃ­stica",leader:"",color:"#003A8C"},
  {id:"cegonha",name:"Cegonha",icon:"ğŸšš",group:"OperaÃ§Ã£o & LogÃ­stica",leader:"",color:"#002766"},
  {id:"coo",name:"COO",icon:"ğŸ¯",group:"OperaÃ§Ã£o & LogÃ­stica",leader:"",color:"#13C2C2"},
  {id:"disponibilidade",name:"Disponibilidade",icon:"ğŸ“Š",group:"OperaÃ§Ã£o & LogÃ­stica",leader:"Queren",color:"#006D75"},
  {id:"posvenda",name:"PÃ³s-venda",icon:"ğŸ“",group:"Cliente",leader:"",color:"#52C41A"},
  {id:"suporte",name:"Suporte",icon:"ğŸ†˜",group:"Cliente",leader:"",color:"#389E0D"},
  {id:"cs",name:"CS (Ritmo)",icon:"â±ï¸",group:"Cliente",leader:"",color:"#237804"},
  {id:"sucesso",name:"Sucesso Cliente",icon:"â­",group:"Cliente",leader:"",color:"#135200"},
  {id:"financeiro",name:"Financeiro",icon:"ğŸ¦",group:"Backoffice",leader:"Daniela",color:"#722ED1"},
  {id:"pessoas",name:"Pessoas e Cultura",icon:"ğŸ‘¥",group:"Backoffice",leader:"JoÃ£o Victor",color:"#531DAB"},
  {id:"qualidade",name:"Qualidade",icon:"âœ…",group:"Backoffice",leader:"Eduardo",color:"#391085"},
  {id:"update",name:"Update",icon:"ğŸ”„",group:"Backoffice",leader:"",color:"#EB2F96"},
  {id:"dashboard",name:"Dashboard (BI)",icon:"ğŸ“ˆ",group:"Sistemas",leader:"",color:"#C41D7F"},
  {id:"dunas",name:"Dunas (Sistema)",icon:"ğŸ’»",group:"Sistemas",leader:"",color:"#9E1068"},
  {id:"apn",name:"APN (Parceiro)",icon:"ğŸ¤",group:"Sistemas",leader:"",color:"#780650"},
  {id:"ia",name:"IA (AutomaÃ§Ã£o)",icon:"ğŸ¤–",group:"EstratÃ©gico",leader:"",color:"#FAAD14"},
  {id:"plus",name:"Plus (InovaÃ§Ã£o)",icon:"ğŸš€",group:"EstratÃ©gico",leader:"",color:"#D48806"},
  {id:"clube",name:"Clube Banco",icon:"ğŸ’³",group:"EstratÃ©gico",leader:"",color:"#AD6800"},
];

const GROUPS=["Vendas & Marketing","OperaÃ§Ã£o & LogÃ­stica","Cliente","Backoffice","Sistemas","EstratÃ©gico"];
const GCOL={"Vendas & Marketing":"#E87722","OperaÃ§Ã£o & LogÃ­stica":"#1890FF","Cliente":"#52C41A","Backoffice":"#722ED1","Sistemas":"#C41D7F","EstratÃ©gico":"#FAAD14"};
const PRI=["ğŸ”´ Alta","ğŸŸ¡ MÃ©dia","ğŸŸ¢ Baixa"];
const STS=["Pendente","Em andamento","ConcluÃ­do","Bloqueado"];
const MOS=["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"];

// ========== DATA ==========
const DB_KEY = "frc-all-data";
let DATA = {};
let PAGE = "dashboard";
let TAB = "vision";
let TOAST_TIMER = null;

function load(){ try{const d=localStorage.getItem(DB_KEY);DATA=d?JSON.parse(d):{}}catch(e){DATA={}} }
function save(){ localStorage.setItem(DB_KEY,JSON.stringify(DATA));toast("âœ… Salvo!") }
function getS(id){ if(!DATA[id])DATA[id]={vision:{mission:"",functions:"",gargalo:"",meta2026:""},pendencias:[],tarefas:[],entregas:[],kpis:[],metas:MOS.map(m=>({month:m,meta:"",realizado:""})),rotinas:"",notes:""};return DATA[id] }
function genId(){return Math.random().toString(36).slice(2,9)}

function toast(msg){
  let t=document.getElementById("toast");
  if(!t){t=document.createElement("div");t.id="toast";t.className="toast";document.body.appendChild(t)}
  t.textContent=msg;t.style.display="block";
  clearTimeout(TOAST_TIMER);TOAST_TIMER=setTimeout(()=>{t.style.display="none"},1800)
}

// ========== RENDER ==========
function render(){
  const app=document.getElementById("app");
  app.innerHTML=`
    <div class="sb">
      <div class="sb-hd">
        <div class="sb-logo">FRC ALL</div>
        <div class="sb-sub">âš¡ Admin â€¢ EdiÃ§Ã£o</div>
      </div>
      <div class="sb-top ${PAGE==="dashboard"?"act":""}" onclick="PAGE='dashboard';render()">
        <span class="ic">ğŸ†</span><span class="nm">Dashboard CEO</span>
      </div>
      <div class="sb-top ${PAGE==="ceo"?"act":""}" onclick="PAGE='ceo';TAB='vision';render()">
        <span class="ic">ğŸ‘”</span><span class="nm">CEO Geral</span>
      </div>
      ${GROUPS.map(g=>`
        <div class="sb-grp" style="color:${GCOL[g]}"><span style="display:inline-block;width:7px;height:7px;border-radius:2px;background:${GCOL[g]};margin-right:4px"></span>${g}</div>
        ${SECTORS.filter(s=>s.group===g).map(s=>`
          <div class="sb-item ${PAGE===s.id?"act":""}" onclick="PAGE='${s.id}';TAB='vision';render()">
            <span class="ic">${s.icon}</span><span class="nm">${s.name}</span>
          </div>
        `).join("")}
      `).join("")}
      <div class="sb-link"><a href="index.html" target="_blank">ğŸ“Š Abrir Painel PÃºblico</a></div>
    </div>
    <div class="mn">
      ${PAGE==="dashboard"?renderDash():PAGE==="ceo"?renderCEO():renderSector(PAGE)}
    </div>
  `;
}

// ========== DASHBOARD ==========
function renderDash(){
  let totalP=0,totalK=0,totalT=0,sumPct=0,cntPct=0;
  SECTORS.forEach(s=>{const d=getS(s.id);totalP+=(d.pendencias||[]).filter(x=>x.status!=="ConcluÃ­do").length;totalK+=(d.kpis||[]).length;totalT+=(d.tarefas||[]).filter(x=>x.status!=="ConcluÃ­do").length;(d.kpis||[]).forEach(k=>{if(k.meta&&k.realizado){sumPct+=Math.min((parseFloat(k.realizado)/parseFloat(k.meta))*100,100);cntPct++}})});
  const avg=cntPct?Math.round(sumPct/cntPct):0;
  const avgCol=avg>=80?"var(--grn)":avg>=50?"var(--ylw)":"var(--red)";

  return `
    <div class="pg-hd">
      <div class="pg-tt">ğŸ† FRC ALL â€” Admin Dashboard</div>
      <span class="pg-badge" style="background:rgba(232,119,34,.15);color:#E87722">24 Setores</span>
    </div>
    <div class="st-grid">
      <div class="st-card"><div class="bar" style="background:var(--red)"></div><div class="st-lb">PendÃªncias Abertas</div><div class="st-val" style="color:var(--red)">${totalP}</div><div class="st-sub">em todos os setores</div></div>
      <div class="st-card"><div class="bar" style="background:var(--ylw)"></div><div class="st-lb">Tarefas Futuras</div><div class="st-val" style="color:var(--ylw)">${totalT}</div><div class="st-sub">a concluir</div></div>
      <div class="st-card"><div class="bar" style="background:var(--blu)"></div><div class="st-lb">KPIs Cadastrados</div><div class="st-val" style="color:var(--blu)">${totalK}</div><div class="st-sub">mÃ©tricas ativas</div></div>
      <div class="st-card"><div class="bar" style="background:var(--grn)"></div><div class="st-lb">Performance Geral</div><div class="st-val" style="color:${avgCol}">${avg}%</div><div class="st-sub">mÃ©dia dos KPIs</div></div>
    </div>
    ${GROUPS.map(g=>`
      <div style="margin-bottom:20px">
        <div style="font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;color:${GCOL[g]};margin-bottom:10px;display:flex;align-items:center;gap:6px">
          <span style="width:10px;height:10px;border-radius:2px;background:${GCOL[g]};display:inline-block"></span>${g}
        </div>
        <div class="sec-grid">
          ${SECTORS.filter(s=>s.group===g).map(s=>{
            const d=getS(s.id);
            const p=(d.pendencias||[]).filter(x=>x.status!=="ConcluÃ­do").length;
            const k=(d.kpis||[]).length;
            return `<div class="sec-card" onclick="PAGE='${s.id}';TAB='vision';render()">
              <div class="sec-top"><span class="sec-ic">${s.icon}</span><div><div class="sec-nm">${s.name}</div><div class="sec-ld">${s.leader||"Sem lÃ­der"}</div></div></div>
              <div class="sec-stats"><div>Pend: <span style="color:${p>0?"var(--red)":"var(--grn)"}">${p}</span></div><div>KPIs: <span>${k}</span></div></div>
              <div class="bar" style="background:${s.color}"></div>
            </div>`;
          }).join("")}
        </div>
      </div>
    `).join("")}
  `;
}

// ========== CEO ==========
function renderCEO(){
  if(!DATA._ceo)DATA._ceo={vision:"",prioridades:"",organograma:"",fluxos:"",rotinas:"",notes:""};
  const c=DATA._ceo;
  const tabs=[{id:"vision",l:"VisÃ£o",i:"ğŸ¯"},{id:"prioridades",l:"Prioridades",i:"ğŸ”¥"},{id:"rotinas",l:"Rotinas",i:"ğŸ“…"},{id:"organograma",l:"Organograma",i:"ğŸ¢"},{id:"fluxos",l:"Fluxos",i:"ğŸ”€"},{id:"notes",l:"Notas",i:"ğŸ“"}];

  return `
    <div class="pg-hd"><div class="pg-tt">ğŸ‘” CEO â€” VisÃ£o Geral</div><span class="pg-badge" style="background:rgba(232,119,34,.15);color:#E87722">Fabinho</span></div>
    <div class="tabs">${tabs.map(t=>`<div class="tab ${TAB===t.id?"act":""}" onclick="TAB='${t.id}';render()">${t.i} ${t.l}</div>`).join("")}</div>
    <div class="card">
      <div class="card-tt" style="margin-bottom:14px">${tabs.find(t=>t.id===TAB).i} ${tabs.find(t=>t.id===TAB).l}</div>
      <textarea id="ceo_${TAB}" style="min-height:300px;font-size:13px;line-height:1.7" placeholder="Edite aqui as informaÃ§Ãµes do CEO â€” ${tabs.find(t=>t.id===TAB).l}...">${c[TAB]||""}</textarea>
      <div style="margin-top:10px;text-align:right"><button class="btn btn-p" onclick="DATA._ceo.${TAB}=document.getElementById('ceo_${TAB}').value;save();render()">ğŸ’¾ Salvar</button></div>
    </div>
  `;
}

// ========== SECTOR ==========
function renderSector(id){
  const cfg=SECTORS.find(s=>s.id===id);
  if(!cfg)return"";
  const d=getS(id);
  const tabs=[
    {id:"vision",l:"VisÃ£o Geral",i:"ğŸ¯"},
    {id:"pendencias",l:"PendÃªncias",i:"ğŸ”´"},
    {id:"tarefas",l:"Tarefas",i:"ğŸŸ "},
    {id:"entregas",l:"Entregas",i:"ğŸ“¦"},
    {id:"kpis",l:"KPIs",i:"ğŸ“Š"},
    {id:"metas",l:"Metas",i:"ğŸ¯"},
    {id:"rotinas",l:"Rotinas",i:"ğŸ“…"},
    {id:"notes",l:"Notas CEO",i:"ğŸ“"}
  ];

  return `
    <div class="pg-hd">
      <div class="pg-tt"><span>${cfg.icon}</span> ${cfg.name}</div>
      <span class="pg-badge" style="background:${cfg.color}22;color:${cfg.color}">${cfg.group}</span>
    </div>
    <div class="tabs">${tabs.map(t=>`<div class="tab ${TAB===t.id?"act":""}" onclick="TAB='${t.id}';render()">${t.i} ${t.l}</div>`).join("")}</div>
    ${TAB==="vision"?renderVision(id,d,cfg):""}
    ${TAB==="pendencias"?renderList(id,d,"pendencias","PendÃªncias","ğŸ”´"):""}
    ${TAB==="tarefas"?renderList(id,d,"tarefas","Tarefas Futuras","ğŸŸ "):""}
    ${TAB==="entregas"?renderList(id,d,"entregas","Entregas","ğŸ“¦"):""}
    ${TAB==="kpis"?renderKPIs(id,d):""}
    ${TAB==="metas"?renderMetas(id,d):""}
    ${TAB==="rotinas"?renderText(id,d,"rotinas","Rotinas do Setor","ğŸ“…"):""}
    ${TAB==="notes"?renderText(id,d,"notes","Notas do CEO","ğŸ“"):""}
  `;
}

function renderVision(id,d,cfg){
  const v=d.vision||{};
  return `<div class="card">
    <div class="card-tt" style="margin-bottom:16px">ğŸ¯ VisÃ£o do Setor</div>
    <div class="vis-grid">
      <div><div class="vis-lb">MissÃ£o</div><textarea id="v_m" placeholder="Para que esse setor existe...">${v.mission||""}</textarea></div>
      <div><div class="vis-lb">FunÃ§Ãµes Principais</div><textarea id="v_f" placeholder="O que entrega no dia a dia...">${v.functions||""}</textarea></div>
      <div><div class="vis-lb">Maior Gargalo</div><textarea id="v_g" placeholder="O que trava resultado...">${v.gargalo||""}</textarea></div>
      <div><div class="vis-lb">Meta 2026</div><textarea id="v_2" placeholder="Onde precisa estar em 2026...">${v.meta2026||""}</textarea></div>
    </div>
    ${cfg.leader?`<div style="margin-top:12px;font-size:11px;color:var(--tx2)"><strong>LÃ­der:</strong> ${cfg.leader}</div>`:""}
    <div style="margin-top:12px;text-align:right"><button class="btn btn-p" onclick="saveVision('${id}')">ğŸ’¾ Salvar VisÃ£o</button></div>
  </div>`;
}

function saveVision(id){
  const d=getS(id);
  d.vision={mission:document.getElementById("v_m").value,functions:document.getElementById("v_f").value,gargalo:document.getElementById("v_g").value,meta2026:document.getElementById("v_2").value};
  DATA[id]=d;save();render();
}

function renderList(id,d,field,title,icon){
  const items=d[field]||[];
  const open=items.filter(x=>x.status!=="ConcluÃ­do").length;
  return `<div class="card">
    <div class="card-hd"><div class="card-tt">${icon} ${title}</div><span style="font-size:11px;color:var(--tx3)">${open} abertas</span></div>
    <div class="fr">
      <input class="if" id="li_d" placeholder="DescriÃ§Ã£o..." onkeydown="if(event.key==='Enter')addItem('${id}','${field}')">
      <input class="is" id="li_r" placeholder="ResponsÃ¡vel">
      <select id="li_p">${PRI.map(p=>`<option>${p}</option>`).join("")}</select>
      <input type="date" id="li_dt" style="width:130px">
      <button class="btn btn-p btn-s" onclick="addItem('${id}','${field}')">+ Adicionar</button>
    </div>
    ${items.length===0?`<div class="empty"><div class="empty-ic">âœ…</div>Nenhum item cadastrado</div>`:`
    <div class="tw"><table><thead><tr><th>DescriÃ§Ã£o</th><th>ResponsÃ¡vel</th><th>Prioridade</th><th>Prazo</th><th>Status</th><th>%</th><th></th></tr></thead><tbody>
      ${items.map((it,i)=>`<tr>
        <td style="max-width:250px">${it.desc}</td>
        <td>${it.responsavel||""}</td>
        <td style="font-size:11px">${it.prioridade||""}</td>
        <td style="font-size:11px;white-space:nowrap">${it.prazo||""}</td>
        <td><select onchange="updItem('${id}','${field}',${i},'status',this.value)" style="padding:3px 6px;font-size:10px">${STS.map(s=>`<option ${it.status===s?"selected":""}>${s}</option>`).join("")}</select></td>
        <td><input type="number" min="0" max="100" value="${it.pct||0}" onchange="updItem('${id}','${field}',${i},'pct',parseInt(this.value)||0)" style="width:50px;padding:3px 5px;font-size:11px;text-align:center"></td>
        <td><button class="btn btn-d btn-s" onclick="delItem('${id}','${field}',${i})">âœ•</button></td>
      </tr>`).join("")}
    </tbody></table></div>`}
  </div>`;
}

function addItem(id,field){
  const d=getS(id);if(!d[field])d[field]=[];
  const desc=document.getElementById("li_d").value.trim();if(!desc)return;
  d[field].push({id:genId(),desc,responsavel:document.getElementById("li_r").value,prioridade:document.getElementById("li_p").value,prazo:document.getElementById("li_dt").value,status:"Pendente",pct:0});
  DATA[id]=d;save();render();
}
function updItem(id,field,i,k,v){const d=getS(id);d[field][i][k]=v;DATA[id]=d;save()}
function delItem(id,field,i){const d=getS(id);d[field].splice(i,1);DATA[id]=d;save();render()}

function renderKPIs(id,d){
  const items=d.kpis||[];
  let avg=0;if(items.length){let s=0,c=0;items.forEach(k=>{if(k.meta&&k.realizado){s+=Math.min((parseFloat(k.realizado)/parseFloat(k.meta))*100,100);c++}});avg=c?Math.round(s/c):0}
  const acol=avg>=80?"var(--grn)":avg>=50?"var(--ylw)":"var(--red)";
  return `<div class="card">
    <div class="card-hd"><div class="card-tt">ğŸ“Š KPIs do Setor</div>${items.length?`<span style="font-family:'Space Mono',monospace;font-size:16px;font-weight:700;color:${acol}">${avg}% geral</span>`:""}</div>
    <div class="fr">
      <input class="if" id="kp_n" placeholder="Nome do KPI..." onkeydown="if(event.key==='Enter')addKPI('${id}')">
      <input class="is" id="kp_m" placeholder="Meta">
      <input class="is" id="kp_r" placeholder="Realizado">
      <select id="kp_u" style="width:70px"><option>%</option><option>$</option><option>un</option><option>h</option><option>dias</option></select>
      <button class="btn btn-p btn-s" onclick="addKPI('${id}')">+ Adicionar</button>
    </div>
    ${items.length===0?`<div class="empty"><div class="empty-ic">ğŸ“Š</div>Nenhum KPI cadastrado</div>`:`
    <div class="kpi-grid">${items.map((k,i)=>{
      const pct=k.meta&&k.realizado?Math.min(Math.round((parseFloat(k.realizado)/parseFloat(k.meta))*100),100):0;
      const col=pct>=80?"var(--grn)":pct>=50?"var(--ylw)":"var(--red)";
      return `<div style="background:var(--bg3);border:1px solid var(--bdr);border-radius:8px;padding:12px">
        <div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:6px">
          <div style="font-size:12px;font-weight:600;flex:1">${k.name}</div>
          <button class="btn btn-d btn-s" onclick="delKPI('${id}',${i})" style="padding:2px 5px;font-size:9px">âœ•</button>
        </div>
        <div style="display:flex;gap:6px;margin-bottom:6px">
          <div style="flex:1"><div style="font-size:9px;color:var(--tx3);margin-bottom:2px">META</div><input value="${k.meta||""}" onchange="updKPI('${id}',${i},'meta',this.value)" style="width:100%;padding:3px 6px;font-size:11px"></div>
          <div style="flex:1"><div style="font-size:9px;color:var(--tx3);margin-bottom:2px">REALIZADO</div><input value="${k.realizado||""}" onchange="updKPI('${id}',${i},'realizado',this.value)" style="width:100%;padding:3px 6px;font-size:11px"></div>
        </div>
        <div class="kpi-bar"><div class="kpi-fill" style="width:${pct}%;background:${col}"></div></div>
        <div style="text-align:center;margin-top:4px;font-family:'Space Mono',monospace;font-size:14px;font-weight:700;color:${col}">${pct}%</div>
      </div>`;
    }).join("")}</div>`}
  </div>`;
}

function addKPI(id){
  const d=getS(id);if(!d.kpis)d.kpis=[];
  const n=document.getElementById("kp_n").value.trim();if(!n)return;
  d.kpis.push({id:genId(),name:n,meta:document.getElementById("kp_m").value,realizado:document.getElementById("kp_r").value,unit:document.getElementById("kp_u").value});
  DATA[id]=d;save();render();
}
function updKPI(id,i,k,v){const d=getS(id);d.kpis[i][k]=v;DATA[id]=d;save();render()}
function delKPI(id,i){const d=getS(id);d.kpis.splice(i,1);DATA[id]=d;save();render()}

function renderMetas(id,d){
  const metas=d.metas||MOS.map(m=>({month:m,meta:"",realizado:""}));
  return `<div class="card">
    <div class="card-tt" style="margin-bottom:14px">ğŸ¯ Metas vs Realizado â€” 2026</div>
    <div class="mt-grid">${metas.map((m,i)=>{
      const pct=m.meta&&m.realizado?Math.min(Math.round((parseFloat(m.realizado)/parseFloat(m.meta))*100),999):null;
      const col=pct===null?"var(--tx3)":pct>=80?"var(--grn)":pct>=50?"var(--ylw)":"var(--red)";
      return `<div class="mt-card">
        <div class="mt-month">${m.month}</div>
        <input placeholder="Meta" value="${m.meta||""}" onchange="updMeta('${id}',${i},'meta',this.value)">
        <input placeholder="Realizado" value="${m.realizado||""}" onchange="updMeta('${id}',${i},'realizado',this.value)">
        <div class="mt-pct" style="color:${col}">${pct!==null?pct+"%":"â€”"}</div>
      </div>`;
    }).join("")}</div>
  </div>`;
}

function updMeta(id,i,k,v){
  const d=getS(id);
  if(!d.metas)d.metas=MOS.map(m=>({month:m,meta:"",realizado:""}));
  d.metas[i][k]=v;DATA[id]=d;save();
}

function renderText(id,d,field,title,icon){
  return `<div class="card">
    <div class="card-tt" style="margin-bottom:14px">${icon} ${title}</div>
    <textarea id="txt_${field}" style="min-height:200px;font-size:13px;line-height:1.7" placeholder="Edite aqui...">${d[field]||""}</textarea>
    <div style="margin-top:10px;text-align:right"><button class="btn btn-p" onclick="saveText('${id}','${field}')">ğŸ’¾ Salvar</button></div>
  </div>`;
}

function saveText(id,field){
  const d=getS(id);d[field]=document.getElementById("txt_"+field).value;DATA[id]=d;save();render();
}

// ========== INIT ==========
load();
render();
</script>
</body>
</html>
